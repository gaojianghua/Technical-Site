# 进程与线程
## 简介

**代码 === 程序**

**进程**: 一个运行的程序（代码）就是一个进程，没有运行的代码叫程序，进程是系统资源分配的最小单位，进程拥有自己独立的内存空间，所以进程间数据不共享，开销大。

**线程**： 调度执行的最小单位，也叫执行路径，不能独立存在，依赖进程，进程至少有一个线程，叫主线程，而多个线程共享内存(数据共享，共享全局变量)，从而极大地提高了程序的运行效率。

**协程**：是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。 协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。



## 特性

**场景**

- 多进程适合在 CPU 密集型操作(cpu 操作指令比较多，如位数多的浮点运算)。
- 多线程适合在 IO 密集型操作(读写数据操作较多的，比如爬虫)。
- 协程可以处理 IO 密集型程序的效率，但是处理 CPU 密集型不是它的长处，如要充分发挥 CPU 利用率可以结合多进程 + 协程。

**差异**

- 进程是并行：同一时刻多个任务同时在运行。
- 线程是并发：同一时间间隔内多个任务都在运行，但是并不会在同一时刻同时运行，存在交替执行的情况。

**协程**

- 执行效率极高，因为子程序切换(函数)不是线程切换,由程序自身控制，没有切换线程的开销。所以与多线程相比，线程的数量越多，协程性能的优势越明显。
- 不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在控制共
  享资源时也不需要加锁，因此执行效率高很多。





## 多线程竞争

同一个进程里线程是数据共享的，当各个线程访问数据资源时会出现竞争状态。

数据几乎同步会被多个线程占用，造成数据混乱 ，即所谓的线程不安全。

**锁**

锁的好处：确保了某段关键代码(共享数据资源)只能由一个线程从头到尾完整地执行能解决多线程资源竞争下的原子操作问题。

锁的坏处：阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大的下降了

锁的致命问题：死锁。

死锁：若干子线程在系统资源竞争时，都在等待对方对某部分资源解除占用状态，结果是谁也不愿先解锁，互相干等着，程序无法执行下去，这就是死锁。



## 区别

**1是多进程	VS	2是多线程**

**数据共享、同步**：

1. 数据共享复杂，需要用IPC；数据是分开的，同步简单
2. 因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂

优劣：各有优势

**内存、CPU**：

1. 占用内存多，切换复杂，CPU利用率低
2. 占用内存少，切换简单，CPU利用率高

优劣：线程占优

**创建销毁、切换**：

1. 创建销毁、切换复杂，速度慢
2. 创建销毁、切换简单，速度很快

优劣：线程占优

**编程、调试**：

1. 编程简单，调试简单
2. 编程复杂，调试复杂

优劣：进程占优

**可靠性**：

1. 进程间不会互相影响
2. 一个线程挂掉将导致整个进程挂掉

优劣：进程占优

**分布式：**

1. 适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单
2. 适应于多核分布式

优劣：进程占优